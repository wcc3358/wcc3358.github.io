<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第06章 SpringBoot之Json数据交互 | 抽象的阶梯</title>
    <meta name="description" content="人生最终价值在于觉醒和思考的能力.">
    <link rel="icon" href="/asserts/logo.ico">
  <link rel="manifest" href="/manifest.json">
    
    <link rel="preload" href="/assets/css/0.styles.ca7a6bcf.css" as="style"><link rel="preload" href="/assets/js/app.46a3c0b1.js" as="script"><link rel="preload" href="/assets/js/2.d2833080.js" as="script"><link rel="preload" href="/assets/js/26.ab0c58ff.js" as="script"><link rel="prefetch" href="/assets/js/10.202a897c.js"><link rel="prefetch" href="/assets/js/11.45fe98ca.js"><link rel="prefetch" href="/assets/js/12.465f7fb8.js"><link rel="prefetch" href="/assets/js/13.004d0863.js"><link rel="prefetch" href="/assets/js/14.bca3d79f.js"><link rel="prefetch" href="/assets/js/15.1b84be48.js"><link rel="prefetch" href="/assets/js/16.5182ca32.js"><link rel="prefetch" href="/assets/js/17.640c3965.js"><link rel="prefetch" href="/assets/js/18.4e9eca15.js"><link rel="prefetch" href="/assets/js/19.07382369.js"><link rel="prefetch" href="/assets/js/20.965ce5c5.js"><link rel="prefetch" href="/assets/js/21.74f04026.js"><link rel="prefetch" href="/assets/js/22.dc009b61.js"><link rel="prefetch" href="/assets/js/23.1aa00b7a.js"><link rel="prefetch" href="/assets/js/24.1f5b1e48.js"><link rel="prefetch" href="/assets/js/25.0ba1bff7.js"><link rel="prefetch" href="/assets/js/27.e708c5d2.js"><link rel="prefetch" href="/assets/js/28.a3636e99.js"><link rel="prefetch" href="/assets/js/29.fba8d62d.js"><link rel="prefetch" href="/assets/js/3.47f25691.js"><link rel="prefetch" href="/assets/js/30.8ac32a15.js"><link rel="prefetch" href="/assets/js/31.2190dd38.js"><link rel="prefetch" href="/assets/js/32.791b47f3.js"><link rel="prefetch" href="/assets/js/33.9540bf04.js"><link rel="prefetch" href="/assets/js/34.c6dc12f7.js"><link rel="prefetch" href="/assets/js/35.7538fa31.js"><link rel="prefetch" href="/assets/js/36.6dcfe6c1.js"><link rel="prefetch" href="/assets/js/37.83463885.js"><link rel="prefetch" href="/assets/js/38.dd01dbdd.js"><link rel="prefetch" href="/assets/js/39.7b55fb59.js"><link rel="prefetch" href="/assets/js/4.2daa4f67.js"><link rel="prefetch" href="/assets/js/40.33036b86.js"><link rel="prefetch" href="/assets/js/41.528d83ac.js"><link rel="prefetch" href="/assets/js/42.c99a35c4.js"><link rel="prefetch" href="/assets/js/43.76e91950.js"><link rel="prefetch" href="/assets/js/44.bc561545.js"><link rel="prefetch" href="/assets/js/45.e8f473f2.js"><link rel="prefetch" href="/assets/js/46.e93ca94a.js"><link rel="prefetch" href="/assets/js/47.61520a1f.js"><link rel="prefetch" href="/assets/js/48.4cb9b493.js"><link rel="prefetch" href="/assets/js/49.de36b047.js"><link rel="prefetch" href="/assets/js/5.dade098f.js"><link rel="prefetch" href="/assets/js/50.e6f026d6.js"><link rel="prefetch" href="/assets/js/51.ea80404f.js"><link rel="prefetch" href="/assets/js/52.8211c4f7.js"><link rel="prefetch" href="/assets/js/53.70046201.js"><link rel="prefetch" href="/assets/js/54.8c385494.js"><link rel="prefetch" href="/assets/js/55.66a91324.js"><link rel="prefetch" href="/assets/js/56.ec7588f0.js"><link rel="prefetch" href="/assets/js/57.a69b6780.js"><link rel="prefetch" href="/assets/js/6.25960aed.js"><link rel="prefetch" href="/assets/js/7.3a1a12f4.js"><link rel="prefetch" href="/assets/js/8.2232b830.js"><link rel="prefetch" href="/assets/js/9.cfbff145.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ca7a6bcf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">抽象的阶梯</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/vuepress/" class="nav-link">Vuepress</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java技术栈" class="dropdown-title"><span class="title">Java技术栈</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/source/" class="nav-link">源码解析</a></li><li class="dropdown-item"><!----> <a href="/java/designPattern/" class="nav-link">设计模式</a></li><li class="dropdown-item"><!----> <a href="/java/dataStructureAndAlgorithm/" class="nav-link">数据结构与算法</a></li><li class="dropdown-item"><!----> <a href="/java/json/" class="nav-link router-link-active">JSON</a></li><li class="dropdown-item"><!----> <a href="/java/maven/" class="nav-link">Maven</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/wcc3358" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/vuepress/" class="nav-link">Vuepress</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java技术栈" class="dropdown-title"><span class="title">Java技术栈</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/source/" class="nav-link">源码解析</a></li><li class="dropdown-item"><!----> <a href="/java/designPattern/" class="nav-link">设计模式</a></li><li class="dropdown-item"><!----> <a href="/java/dataStructureAndAlgorithm/" class="nav-link">数据结构与算法</a></li><li class="dropdown-item"><!----> <a href="/java/json/" class="nav-link router-link-active">JSON</a></li><li class="dropdown-item"><!----> <a href="/java/maven/" class="nav-link">Maven</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/wcc3358" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JSON</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java/json/第01章 JSON简介.html" class="sidebar-link">第01章 JSON简介</a></li><li><a href="/java/json/第02章 org.json.html" class="sidebar-link">第01章 org.json</a></li><li><a href="/java/json/第03章 GSON.html" class="sidebar-link">第03章 GSON</a></li><li><a href="/java/json/第04章 Jackson.html" class="sidebar-link">第04章 Jackson</a></li><li><a href="/java/json/第05章 fastjson.html" class="sidebar-link">第05章 fastjson</a></li><li><a href="/java/json/第06章 SpringBoot之Json数据交互.html" class="active sidebar-link">第06章 SpringBoot之Json数据交互</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java/json/第06章 SpringBoot之Json数据交互.html#_1-1-json报文" class="sidebar-link">1.1 json报文</a></li><li class="sidebar-sub-header"><a href="/java/json/第06章 SpringBoot之Json数据交互.html#_1-2-接口规范" class="sidebar-link">1.2 接口规范</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java/json/第06章 SpringBoot之Json数据交互.html#_1-2-1-响应报文规范" class="sidebar-link">1.2.1 响应报文规范</a></li><li class="sidebar-sub-header"><a href="/java/json/第06章 SpringBoot之Json数据交互.html#_1-2-2-请求数据规范" class="sidebar-link">1.2.2 请求数据规范</a></li></ul></li><li class="sidebar-sub-header"><a href="/java/json/第06章 SpringBoot之Json数据交互.html#_1-3-参数校验" class="sidebar-link">1.3 参数校验</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java/json/第06章 SpringBoot之Json数据交互.html#_1-3-1-简单参数校验" class="sidebar-link">1.3.1 简单参数校验</a></li><li class="sidebar-sub-header"><a href="/java/json/第06章 SpringBoot之Json数据交互.html#_1-3-2-复杂参数校验" class="sidebar-link">1.3.2 复杂参数校验</a></li></ul></li><li class="sidebar-sub-header"><a href="/java/json/第06章 SpringBoot之Json数据交互.html#_1-4-xml报文" class="sidebar-link">1.4 XML报文</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="第06章-springboot之json数据交互"><a href="#第06章-springboot之json数据交互" class="header-anchor">#</a> 第06章 SpringBoot之Json数据交互</h1> <h2 id="_1-1-json报文"><a href="#_1-1-json报文" class="header-anchor">#</a> 1.1 json报文</h2> <p>SpringBoot 默认会使用 Json 作为响应报文格式。首先，我们创建一个 UserController 用于处理前端的 Web 请求。
定义一个简单的控制器，与通常返回 Url 的 Controller 不一样的是，login() 使用了 @ResponseBody 注解，它表示此接口响应为纯数据，不带任何界面展示，可以获得标准Json。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/user&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>
 
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token comment">//使用reqUser模型来接受，而不用User</span>
    <span class="token keyword">public</span> <span class="token class-name">RespEntity</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">ReqUser</span> reqUser<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>reqUser <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>reqUser<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            user<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>reqUser<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
 		<span class="token comment">//返回的响应实体具体看下节</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RespEntity</span><span class="token punctuation">(</span><span class="token class-name">RespCode</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>对于上面的代码来说，还可以做进一步的优化，由于所有的 Restful 接口都只是返回数据，所以我们可以直接在类级别上添加 @ResponseBody 注解。而大多数情况下，@Controller 与 @ResponseBody 又会一起使用，所以我们使用 @RestController 注解来替换掉它们，从而更加简洁地实现功能。</p> <h2 id="_1-2-接口规范"><a href="#_1-2-接口规范" class="header-anchor">#</a> 1.2 接口规范</h2> <p>对于每一家公司来说，都会定义自己的数据规范，一个统一且标准的数据规范对于系统维护来说是非常重要的，也在很在程度上提升了开发效率。</p> <h3 id="_1-2-1-响应报文规范"><a href="#_1-2-1-响应报文规范" class="header-anchor">#</a> 1.2.1 响应报文规范</h3> <p>接口响应至少需要告诉使用方三项信息：状态码、描述、数据。其中，数据不是每个接口必须的，如果只是一个简单修改的动作，可能就没有必须返回数据了。下面我们定义一个 RespEntity类来封装我们的响应报文model:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RespEntity</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> code<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> msg<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> data<span class="token punctuation">;</span>
 
    <span class="token keyword">public</span> <span class="token class-name">RespEntity</span><span class="token punctuation">(</span><span class="token class-name">RespCode</span> respCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> respCode<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">=</span> respCode<span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token keyword">public</span> <span class="token class-name">RespEntity</span><span class="token punctuation">(</span><span class="token class-name">RespCode</span> respCode<span class="token punctuation">,</span> <span class="token class-name">Object</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>respCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>同时，定义一个枚举类来维护我们的状态码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">RespCode</span> <span class="token punctuation">{</span>
 
    <span class="token function">SUCCESS</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;请求成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">WARN</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;网络异常，请稍后重试&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token keyword">private</span> <span class="token keyword">int</span> code<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> msg<span class="token punctuation">;</span>
 
    <span class="token class-name">RespCode</span><span class="token punctuation">(</span><span class="token keyword">int</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">=</span> msg<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> code<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> msg<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>这样，我们的响应数据规范已基本建立。</p> <h3 id="_1-2-2-请求数据规范"><a href="#_1-2-2-请求数据规范" class="header-anchor">#</a> 1.2.2 请求数据规范</h3> <p>响应报文格式我们已经定义好了，那么请求数据我们如何接收呢？
一般来说，请求与响应会使用相同的报文形式。如果响应为Json，那么请求也建议使用Json。
为登录请求添加输入参数，首先，需要我们定义好用户实体User类，直接在映射方法login() 使用该实体进行参数接收，并将接收到的参数直接返回，1.节代码已实现。
调出Postman，填写正确的Url，选择POST方式发送请求，选择Body，将 Content-Type 设置成 application/json，填入 Json 格式的请求数据，点击 Send 即可得到如下结果。</p> <p><a data-fancybox="" title="1550930160097" href="/assets/1550930160097.png"><img src="/assets/1550930160097.png" alt="1550930160097"></a></p> <p>数据接收非常成功，但在上面的响应报文中，存在着了一个非常严重的问题，那就是用户的密码也随同用户信息一起返回给了客户端，显然这并不是一种正确的做法。
我们需要对其进行一次过滤，由于 SpringBoot 默认使用 Jackson 作为 Json 序列化工具，如果想要过滤掉响应中的某些字段，只需在过滤字段对应的 get 方法上加上 @JsonIgnore 注解即可。
但这样又会引发另外一个问题，那就是请求中的字段也被过滤掉了，对于这种问题，可以采用抽离请求参数模型的方式进行处理，即自定义一套参数接收的 Model，比如，接收用户登录的会使用 ReqUser 来进行参数接收，这样使得请求参数模型与数据库映射实体完全分离，在一定程度上提升了系统的安全性。替换成 Model 对象后（1.节的代码已经替换好了），我们就可以在数据库映射实体 User 上增加 @JsonIgnore 注解忽略该字段的序列化，而不影响请求参数的输入。</p> <p><a data-fancybox="" title="1550930282966" href="/assets/1550930282966.png"><img src="/assets/1550930282966.png" alt="1550930282966"></a></p> <h2 id="_1-3-参数校验"><a href="#_1-3-参数校验" class="header-anchor">#</a> 1.3 参数校验</h2> <p>出于系统健壮性的考虑，我们需要对所有的参数进行必要性校验，如：登录请求时，如果没有用户名，程序应该立即驳回该请求。上面请求参数模型（Model）的抽象也使得我们对数据校验更加方便，当然主要还是依赖于 SpringBoot 的 Validate 功能的强大支持。</p> <h3 id="_1-3-1-简单参数校验"><a href="#_1-3-1-简单参数校验" class="header-anchor">#</a> 1.3.1 简单参数校验</h3> <p>对于登录接口来说，用户名与密码都是必输的，那么我们现在为其添加上对应的参数校验，无需 if-else 判断，简单的几个注解就可以帮助我们完成所有的工作。(下面没有加入参数BindResult)</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginController</span> <span class="token punctuation">{</span>
 
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">RespEntity</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token annotation punctuation">@Valid</span> <span class="token class-name">ReqUser</span> reqUser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>模型中增加注解</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReqUser</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">&quot;用户名不能为空&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">&quot;密码不能为空&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> password<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>我们为请求参数的 Model 对象ReqUser 加上了 @Valid 注解，并在 Model 类中对需要校验字段的 <strong>get 方法上</strong>添加相应的校验注解。效果如下：</p> <p><a data-fancybox="" title="1550930577460" href="/assets/1550930577460.png"><img src="/assets/1550930577460.png" alt="1550930577460"></a></p> <h3 id="_1-3-2-复杂参数校验"><a href="#_1-3-2-复杂参数校验" class="header-anchor">#</a> 1.3.2 复杂参数校验</h3> <p><strong>正则表示式校验</strong></p> <p>如果用户的登录名为手机号，那么就需要对登录名的格式做进一步的校验，下面使用正则表达式来校验手机号的合法性。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">&quot;用户名不能为空&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Pattern</span><span class="token punctuation">(</span>
    regexp <span class="token operator">=</span> <span class="token string">&quot;1(([38]\\d)|(5[^4&amp;&amp;\\d])|(4[579])|(7[0135678]))\\d{8}&quot;</span><span class="token punctuation">,</span>
    message <span class="token operator">=</span> <span class="token string">&quot;手机号格式不合法&quot;</span>
<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> username<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>自定义校验注解</strong></p> <p>在系统使用过程中，有很多地方需要对手机号的格式进行校验，如：注册、验证码发送等。
但校验手机号的正则表达式又过于复杂，如果多处编写，一旦运营商增加某个号段，对程序的维护人员来说就是一个噩耗。这时，可以使用自定义校验注解来代替这些常用的校验。
手机号校验注解 Phone：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Constraint</span><span class="token punctuation">(</span>validatedBy <span class="token operator">=</span> <span class="token class-name">PhoneValidator</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>METHOD<span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>FIELD<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Phone</span> <span class="token punctuation">{</span>
 
    <span class="token class-name">String</span> <span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;手机号格式不合法&quot;</span><span class="token punctuation">;</span>
 
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">groups</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
 
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Payload</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">payload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>手机号校验实现类 PhoneValidator：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PhoneValidator</span> <span class="token keyword">implements</span> <span class="token class-name">ConstraintValidator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Phone</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
 
    <span class="token keyword">private</span> <span class="token class-name">Pattern</span> pattern <span class="token operator">=</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token string">&quot;1(([38]\\d)|(5[^4&amp;&amp;\\d])|(4[579])|(7[0135678]))\\d{8}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token class-name">Phone</span> phone<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
 
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isValid</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">,</span> <span class="token class-name">ConstraintValidatorContext</span> constraintValidatorContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> pattern<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>Model 上的使用：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Phone</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> username<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>这样的话，如果因为某些不可抗拒因素导致校验规则的变动，只需要修改一处理即可，维护成本大大降低。</p> <p><a data-fancybox="" title="1550930790005" href="/assets/1550930790005.png"><img src="/assets/1550930790005.png" alt="1550930790005"></a></p> <h2 id="_1-4-xml报文"><a href="#_1-4-xml报文" class="header-anchor">#</a> 1.4 XML报文</h2> <p>大多数情况下，使用 Json 就可以满足我们的需求了，但仍然存在某些特定的场景需要使用到 XML 形式的报文，如：微信公众号开发。不过不用担心，切换成 XML 报文也只需要做轻微的改动，添加相关依赖如下</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token string gstring">&quot;com.fasterxml.jackson.dataformat:jackson-dataformat-xml:2.8.8&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后就可以开始进行测试了，此处借助一个模拟 HTTP 请求工具（Postman）来协助我们测试该接口：</p> <p><a data-fancybox="" title="1550930875427" href="/assets/1550930875427.png"><img src="/assets/1550930875427.png" alt="1550930875427"></a></p> <p>在上面的测试范例里，我们指定了 Accept 为 text/xml，这样 SpringBoot 就会返回 XML 形式的数据。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/20/2019, 11:49:45 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/java/json/第05章 fastjson.html" class="prev">第05章 fastjson</a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.46a3c0b1.js" defer></script><script src="/assets/js/2.d2833080.js" defer></script><script src="/assets/js/26.ab0c58ff.js" defer></script>
  </body>
</html>
